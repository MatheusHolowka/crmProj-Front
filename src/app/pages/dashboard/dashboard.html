<div
  class="flex h-screen w-full overflow-hidden bg-[#F3F5F9] dark:bg-slate-950 transition-colors duration-500"
>
  <app-sidebar class="flex-none h-full z-20 shadow-xl"></app-sidebar>

  <main class="flex-1 flex flex-col h-full relative min-w-0" cdkDropListGroup>
    <header class="flex-none flex justify-between items-center px-8 py-6 bg-transparent z-10">
      <div>
        <h1 class="text-3xl font-black tracking-tight text-slate-900 dark:text-white italic">
          CORE<span class="text-indigo-600">KANBAN</span>
        </h1>
        <p class="text-slate-500 dark:text-slate-400 font-medium text-sm mt-1">
          Fluxo de Monitoramento de Leads Ativo
        </p>
      </div>

      <div class="flex gap-3">
        <button
          class="hidden md:flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-lg shadow-indigo-200 dark:shadow-none transition-all hover:-translate-y-0.5"
        >
          <span>+</span> Novo Card
        </button>
      </div>
    </header>

    <div class="flex-1 overflow-x-auto overflow-y-hidden p-8 pt-0 custom-scrollbar">
      <div class="flex h-full gap-6">
        <ng-container
          *ngFor="
            let coluna of [
              { titulo: 'Novos Leads', cor: 'bg-indigo-500', lista: novosLeads },
              { titulo: 'Qualificação', cor: 'bg-amber-500', lista: qualificacao },
              { titulo: 'Proposta', cor: 'bg-emerald-500', lista: proposta },
              { titulo: 'Fechamento', cor: 'bg-blue-600', lista: fechamento },
            ]
          "
        >
          <div class="flex flex-col min-w-[320px] max-w-[400px] flex-1 h-full">
            <div class="flex items-center justify-between mb-4 px-1 flex-none">
              <h2
                class="font-bold text-slate-700 dark:text-slate-300 flex items-center gap-2 uppercase text-xs tracking-widest"
              >
                <span [class]="'w-2.5 h-2.5 rounded-full shadow-sm ' + coluna.cor"></span>
                {{ coluna.titulo }}
              </h2>
              <span
                class="bg-white dark:bg-slate-800 text-slate-500 px-2.5 py-1 rounded-lg text-xs font-bold border border-slate-200 dark:border-slate-700 shadow-sm"
              >
                {{ coluna.lista.length }}
              </span>
            </div>

            <div
              cdkDropList
              [cdkDropListData]="coluna.lista"
              (cdkDropListDropped)="drop($event)"
              class="flex-1 overflow-y-auto custom-scrollbar-y rounded-[1.5rem] bg-slate-200/50 dark:bg-slate-900/40 p-3 border-2 border-dashed border-transparent hover:border-indigo-500/10 transition-colors"
            >
              <div
                *ngFor="let lead of coluna.lista"
                cdkDrag
                class="bg-white dark:bg-slate-900 p-3 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 mb-2 cursor-grab active:cursor-grabbing hover:border-indigo-400 dark:hover:border-indigo-500 hover:shadow-md transition-all duration-200 group relative"
              >
                <div class="flex justify-between items-start mb-1.5 h-6">
                  <span
                    class="text-[9px] font-black uppercase tracking-wide text-indigo-700 bg-indigo-50 dark:bg-indigo-500/20 dark:text-indigo-300 px-1.5 py-0.5 rounded self-center"
                  >
                    {{ lead.origem }}
                  </span>

                  <div class="flex items-center gap-1">
                    <button
                      (click)="editarLead(lead); $event.stopPropagation()"
                      class="opacity-0 group-hover:opacity-100 transition-opacity p-1 -mt-0.5 rounded-md hover:bg-indigo-50 dark:hover:bg-indigo-900/30 text-slate-400 hover:text-indigo-600"
                      title="Editar Card"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        class="w-3.5 h-3.5"
                      >
                        <path
                          d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"
                        />
                        <path
                          d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25v-5.5a.75.75 0 00-1.5 0v5.5a1.25 1.25 0 01-1.25 1.25h-9.5a1.25 1.25 0 01-1.25-1.25v-9.5z"
                        />
                      </svg>
                    </button>

                    <span class="text-slate-400 text-[9px] font-semibold min-w-[30px] text-right">{{
                      lead.tempo
                    }}</span>
                  </div>
                </div>

                <div class="pr-2">
                  <h3
                    class="font-bold text-slate-800 dark:text-slate-100 text-sm leading-tight mb-0.5"
                  >
                    {{ lead.nome }}
                  </h3>

                  <p
                    class="text-[10px] text-slate-500 dark:text-slate-400 truncate leading-relaxed italic pr-1 inline-block w-full opacity-80"
                  >
                    "{{ lead.mensagem }}"
                  </p>
                </div>

                <div
                  class="flex items-center gap-2 mt-2 pt-2 border-t border-slate-100 dark:border-slate-800"
                >
                  <div
                    class="w-5 h-5 rounded-full bg-gradient-to-br from-indigo-500 to-cyan-400 flex items-center justify-center text-[8px] text-white font-black shadow-sm"
                  >
                    {{ lead.nome[0] }}
                  </div>
                  <span
                    class="text-[9px] font-bold text-slate-400 uppercase tracking-wide truncate max-w-[120px]"
                    >{{ lead.localidade }}</span
                  >
                </div>

                <div *cdkDragPlaceholder class="opacity-0"></div>

                <div
                  *cdkDragPreview
                  class="bg-white dark:bg-slate-900 p-3 rounded-xl shadow-xl border border-indigo-500/30 w-[280px] opacity-95"
                >
                  <h3 class="font-bold text-indigo-600 text-sm">Editando {{ lead.nome }}...</h3>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </main>
</div>
